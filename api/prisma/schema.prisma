generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = "file:../data/db.sqlite3"
}

model User {
  id       Int     @id @default(autoincrement())
  email    String  @unique
  password String
  isAdmin  Boolean @default(false)
}

model Manga {
  id          Int     @id @default(autoincrement())
  title       String?
  status      Int?
  description String?
  authors     String?
  genres      String?
  remarks     String?

  updatedAt DateTime @updatedAt
  createdAt DateTime @default(now())

  chapterGroups ChapterGroup[]
  cover         Image?
}

model ChapterGroup {
  id    Int     @id @default(autoincrement())
  title String?

  manga    Manga @relation(fields: [mangaId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  mangaId  Int
  sequence Int

  chapters Chapter[]
}

model Chapter {
  id     Int     @id @default(autoincrement())
  title  String?
  locked Boolean @default(false)

  updatedAt DateTime @updatedAt
  createdAt DateTime @default(now())

  chapterGroup   ChapterGroup @relation(fields: [chapterGroupId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  chapterGroupId Int
  sequence       Int

  images Image[]
}

model Image {
  id Int @id @default(autoincrement())

  // as content
  chapter   Chapter? @relation(fields: [chapterId], references: [id], onDelete: SetNull, onUpdate: SetNull)
  chapterId Int?
  sequence  Int?

  // as cover
  manga   Manga? @relation(fields: [mangaId], references: [id], onDelete: SetNull, onUpdate: SetNull)
  mangaId Int?   @unique
}
